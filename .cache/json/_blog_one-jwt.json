{"data":{"markdownRemark":{"html":"<p><em>Okay let's setup the scenario here.</em></p>\n<p>Let's say you have a Node.js API and some front end framework, and you are using AWS Cognito to handle the authentication dance ðŸ’ƒ via the client side SDK either through Amplify or some other means.</p>\n<p>Now you also want to <strong>authenticate</strong> your API calls against the <strong>same user</strong>, against the <strong>same token</strong>. This easily done by using that JWT and a JWKS on the server side to validate the JWT signature.</p>\n<p>I'll show you how via a typical middleware.</p>\n<p>First head over to <a href=\"https://jwt.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jwt.io</a>, this amazing tool will decode your JWT into something readable like ðŸ‘‡</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/pxvqbad24evh7muafdbz.png\" alt=\"Alt Text\"></p>\n<p><em>On to the Node.js middleware</em></p>\n<p>Let's start with a class so we can define some protected functions. You could also just do functional programming here too. Whatever floats your boat â›µ</p>\n<p>Using <a href=\"https://github.com/panva/jose\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jose</a> it would look something like this to authenticate the token and either return the validated signature or fail.\n<img src=\"https://dev-to-uploads.s3.amazonaws.com/i/z8brq5fo3mv850o1z1fu.png\" alt=\"Alt Text\"></p>\n<p>You may need to get the token from the head in a more specific way like so.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    let token = context?.request?.headers().authorization || &#39;&#39;\n    // Remove &quot;Bearer &quot; from start of token\n    return (token = token.substring(7, token.length)) </code></pre></div>\n<p>From here is just a matter of <strong>context</strong> depending on what language you are using.</p>\n<p>I hope this help some one who has read the below AWS cognito guide and found that to be underwhelming.</p>\n<p>ðŸ––</p>\n<blockquote>\n<p>References</p>\n</blockquote>\n<p><a href=\"https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AWS Guide</a> - <a href=\"https://github.com/panva/jose\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jose</a></p>","frontmatter":{"title":"One JWT to rule them all","description":"using jwt with jwks congnito example","date":"2020-10-26T00:00:00.000Z","slug":"/blog/one-jwt","tags":["cognito","jwt","jwks","auth"]}}},"pageContext":{}}